const action = require("../src/handfoot/action");
const db = require("../src/handfoot/db");
const game = require("../src/handfoot/game");

async function doTest() {
    var eventData;
    
    /** CREATE SNAPSHOT */
    var gameId = "701-346";
    // eventData = { "message": "doaction", "game": "debug", "action": "_SNAPSHOT_", "value": gameId };
    // var n = await game.createSnapshot(eventData.value);
    
    /** GET SNAPSHOT DATA */
    // var d = await db.getData(gameId, n.toString());
    // console.log(JSON.stringify(d.data));

    /** SET GAME DATA */
    var d = [{"gameId":"701-346","subId":"tables","tables":["tables","701-346","p-702-290","p-999-450","p-397-630","p-036-055","t-265-035","t-584-039"]},{"subId":"701-346","gameId":"701-346","drawPile":[{"name":"10","id":264,"suit":"S","idx":156},{"name":"2","id":81,"suit":"C","idx":157},{"name":"6","id":260,"suit":"S","idx":158},{"name":"8","id":141,"suit":"C","idx":159},{"name":"9","id":62,"suit":"H","idx":160},{"name":"2","id":217,"suit":"H","idx":161},{"name":"4","id":219,"suit":"H","idx":162},{"name":"9","id":155,"suit":"S","idx":163},{"name":"J","id":103,"suit":"S","idx":164},{"name":"Q","id":240,"suit":"D","idx":165},{"name":"J","id":144,"suit":"C","idx":166},{"name":"4","id":245,"suit":"C","idx":167},{"name":"A","id":54,"suit":"H","idx":168},{"name":"K","id":120,"suit":"H","idx":169},{"name":"2","id":176,"suit":"D","idx":170},{"name":"K","id":241,"suit":"D","idx":171},{"name":"J","id":36,"suit":"C","idx":172},{"name":"2","id":68,"suit":"D","idx":173},{"name":"9","id":263,"suit":"S","idx":174},{"name":"10","id":184,"suit":"D","idx":175},{"name":"9","id":8,"suit":"H","idx":176},{"name":"6","id":247,"suit":"C","idx":177},{"name":"Q","id":78,"suit":"D","idx":178},{"name":"3","id":2,"suit":"H","idx":179},{"name":"9","id":224,"suit":"H","idx":180},{"name":"Q","id":37,"suit":"C","idx":181},{"name":"6","id":85,"suit":"C","idx":182},{"name":"7","id":235,"suit":"D","idx":183},{"name":"7","id":73,"suit":"D","idx":184},{"name":"4","id":124,"suit":"D","idx":185},{"name":"5","id":4,"suit":"H","idx":186},{"name":"5","id":71,"suit":"D","idx":187},{"name":"8","id":236,"suit":"D","idx":188},{"name":"3","id":231,"suit":"D","idx":189},{"name":"3","id":164,"suit":"H","idx":190},{"name":"K","id":254,"suit":"C","idx":191},{"name":"9","id":116,"suit":"H","idx":192},{"name":"6","id":31,"suit":"C","idx":193},{"name":"6","id":126,"suit":"D","idx":194},{"name":"6","id":18,"suit":"D","idx":195},{"name":"K","id":92,"suit":"C","idx":196},{"name":"A","id":80,"suit":"C","idx":197},{"name":"Q","id":104,"suit":"S","idx":198},{"name":"9","id":88,"suit":"C","idx":199},{"name":"6","id":59,"suit":"H","idx":200},{"name":"Q","id":186,"suit":"D","idx":201},{"name":"A","id":13,"suit":"D","idx":202},{"name":"2","id":148,"suit":"S","idx":203},{"name":"4","id":204,"suit":"S","idx":204},{"name":"Q","id":132,"suit":"D","idx":205},{"name":"10","id":156,"suit":"S","idx":206},{"name":"4","id":70,"suit":"D","idx":207},{"name":"4","id":191,"suit":"C","idx":208},{"name":"10","id":63,"suit":"H","idx":209},{"name":"A","id":26,"suit":"C","idx":210},{"name":"4","id":178,"suit":"D","idx":211},{"name":"7","id":86,"suit":"C","idx":212},{"name":"8","id":46,"suit":"S","idx":213},{"name":"5","id":205,"suit":"S","idx":214},{"name":"A","id":147,"suit":"S","idx":215},{"name":"J","id":161,"suit":null,"idx":216},{"name":"J","id":23,"suit":"D","idx":217},{"name":"2","id":230,"suit":"D","idx":218},{"name":"9","id":21,"suit":"D","idx":219},{"name":"10","id":210,"suit":"S","idx":220},{"name":"6","id":193,"suit":"C","idx":221},{"name":"K","id":159,"suit":"S","idx":222},{"name":"2","id":27,"suit":"C","idx":223},{"name":"8","id":87,"suit":"C","idx":224},{"name":"Q","id":50,"suit":"S","idx":225},{"name":"J","id":268,"suit":null,"idx":226},{"name":"5","id":138,"suit":"C","idx":227},{"name":"5","id":112,"suit":"H","idx":228},{"name":"K","id":38,"suit":"C","idx":229},{"name":"J","id":106,"suit":null,"idx":230},{"name":"4","id":42,"suit":"S","idx":231},{"name":"9","id":129,"suit":"D","idx":232},{"name":"7","id":181,"suit":"D","idx":233},{"name":"A","id":229,"suit":"D","idx":234},{"name":"J","id":215,"suit":null,"idx":235},{"name":"J","id":252,"suit":"C","idx":236},{"name":"K","id":187,"suit":"D","idx":237},{"name":"A","id":67,"suit":"D","idx":238},{"name":"8","id":262,"suit":"S","idx":239},{"name":"9","id":101,"suit":"S","idx":240},{"name":"Q","id":91,"suit":"C","idx":241},{"name":"J","id":211,"suit":"S","idx":242},{"name":"A","id":121,"suit":"D","idx":243},{"name":"Q","id":158,"suit":"S","idx":244},{"name":"3","id":56,"suit":"H","idx":245},{"name":"Q","id":253,"suit":"C","idx":246},{"name":"K","id":51,"suit":"S","idx":247},{"name":"K","id":267,"suit":"S","idx":248},{"name":"J","id":157,"suit":"S","idx":249},{"name":"6","id":139,"suit":"C","idx":250},{"name":"5","id":43,"suit":"S","idx":251},{"name":"2","id":163,"suit":"H","idx":252},{"name":"5","id":17,"suit":"D","idx":253},{"name":"3","id":95,"suit":"S","idx":254},{"name":"10","id":225,"suit":"H","idx":255},{"name":"4","id":258,"suit":"S","idx":256},{"name":"4","id":83,"suit":"C","idx":257},{"name":"2","id":243,"suit":"C","idx":258},{"name":"6","id":206,"suit":"S","idx":259},{"name":"6","id":167,"suit":"H","idx":260},{"name":"9","id":142,"suit":"C","idx":261},{"name":"J","id":107,"suit":null,"idx":262},{"name":"3","id":149,"suit":"S","idx":263},{"name":"4","id":165,"suit":"H","idx":264},{"name":"7","id":153,"suit":"S","idx":265},{"name":"Q","id":199,"suit":"C","idx":266},{"name":"6","id":72,"suit":"D","idx":267},{"name":"K","id":174,"suit":"H","idx":268},{"name":"J","id":265,"suit":"S","idx":269}],"state":{"activeDrawer":"p-397-630","firstPlayer":"p-702-290","teams":{"t-265-035":{"subId":"t-265-035","score":0,"names":["Mark","fdsa"],"ids":["p-702-290","p-397-630"],"index":0,"cardCt":[2,11],"played":{"4":{"clean":0,"wild":0},"5":{"clean":5,"wild":0},"6":{"clean":2,"wild":1},"7":{"clean":5,"wild":1},"8":{"clean":6,"wild":0},"9":{"clean":3,"wild":0},"10":{"clean":5,"wild":1},"Q":{"clean":0,"wild":0},"A":{"clean":2,"wild":1},"W":{"clean":0,"wild":0},"J":{"clean":4,"wild":1},"K":{"clean":0,"wild":0}},"melded":true,"inFoot":["p-397-630"]},"t-584-039":{"subId":"t-584-039","score":0,"names":["asdf","qwer"],"ids":["p-999-450","p-036-055"],"index":1,"cardCt":[1,2],"played":{"4":{"clean":3,"wild":1},"5":{"clean":6,"wild":1},"6":{"clean":3,"wild":1},"7":{"clean":7,"wild":0},"8":{"clean":6,"wild":2},"9":{"clean":4,"wild":0},"10":{"clean":7,"wild":2},"Q":{"clean":0,"wild":0},"A":{"clean":8,"wild":1},"W":{"clean":0,"wild":0},"J":{"clean":6,"wild":1},"K":{"clean":0,"wild":0}},"melded":true,"inFoot":["p-999-450","p-036-055"]}},"lastDrawer":"p-397-630","ready":true,"playerOut":null,"drawIndex":0,"didDeal":["p-702-290","p-999-450","p-397-630","p-036-055"],"shuffled":true,"lastMessage":"Mark discarded KH","activePlayer":{"name":"asdf","id":"p-999-450","inFoot":true},"teamsReady":true},"created":1586886328241,"playOrder":["p-702-290","p-999-450","p-397-630","p-036-055"]},{"subId":"p-702-290","gameId":"701-346","partner":"p-397-630","teamIdx":0,"teamid":"t-265-035","name":"Mark","connectionId":"K_a3HcdUiYcCHzA=","canDraw":false,"foot":[{"name":"J","id":77,"suit":"D","idx":67},{"name":"2","id":109,"suit":"H","idx":69},{"name":"8","id":208,"suit":"S","idx":71},{"name":"7","id":140,"suit":"C","idx":73},{"name":"9","id":209,"suit":"S","idx":75},{"name":"7","id":207,"suit":"S","idx":77},{"name":"8","id":74,"suit":"D","idx":79},{"name":"A","id":201,"suit":"S","idx":81},{"name":"K","id":213,"suit":"S","idx":83},{"name":"10","id":117,"suit":"H","idx":85},{"name":"K","id":146,"suit":"C","idx":87}],"didDraw":false,"inFoot":false,"hand":[{"name":"2","id":55,"suit":"H","idx":86},{"name":"Q","id":212,"suit":"S","idx":152}]},{"subId":"p-999-450","gameId":"701-346","partner":"p-036-055","teamIdx":1,"teamid":"t-584-039","name":"asdf","connectionId":"K_ad4fAJCYcCIlw=","canDraw":false,"foot":[],"didDraw":true,"inFoot":true,"hand":[{"name":"10","id":143,"suit":"C","idx":154}]},{"subId":"p-397-630","gameId":"701-346","partner":"p-702-290","teamIdx":0,"teamid":"t-265-035","name":"fdsa","connectionId":"K_a3wfqaiYcCFmQ=","canDraw":false,"foot":[],"didDraw":false,"inFoot":true,"hand":[{"name":"K","id":133,"suit":"D","idx":23},{"name":"8","id":61,"suit":"H","idx":25},{"name":"7","id":222,"suit":"H","idx":27},{"name":"J","id":10,"suit":"H","idx":29},{"name":"Q","id":119,"suit":"H","idx":31},{"name":"Q","id":65,"suit":"H","idx":33},{"name":"5","id":246,"suit":"C","idx":35},{"name":"3","id":69,"suit":"D","idx":37},{"name":"K","id":200,"suit":"C","idx":39},{"name":"K","id":79,"suit":"D","idx":41},{"name":"A","id":39,"suit":"S","idx":43}]},{"subId":"p-036-055","gameId":"701-346","partner":"p-999-450","teamIdx":1,"teamid":"t-584-039","name":"qwer","connectionId":"K_ae7dNuCYcCItw=","canDraw":false,"foot":[],"didDraw":false,"inFoot":true,"hand":[{"name":"K","id":228,"suit":"H","idx":49},{"name":"3","id":190,"suit":"C","idx":55}]},{"subId":"t-265-035","gameId":"701-346","score":0,"cards":{"4":{"played":[]},"5":{"played":[{"name":"5","id":151,"suit":"S","idx":84},{"name":"5","id":84,"suit":"C","idx":88},{"name":"5","id":259,"suit":"S","idx":121},{"name":"5","id":233,"suit":"D","idx":124},{"name":"5","id":58,"suit":"H","idx":145}]},"6":{"played":[{"name":"6","id":180,"suit":"D","idx":109},{"name":"6","id":98,"suit":"S","idx":30},{"name":"2","id":40,"suit":"S","idx":149}]},"7":{"played":[{"name":"7","id":114,"suit":"H","idx":82},{"name":"7","id":32,"suit":"C","idx":74},{"name":"J","id":214,"suit":null,"idx":70},{"name":"7","id":127,"suit":"D","idx":132},{"name":"7","id":248,"suit":"C","idx":140},{"name":"7","id":6,"suit":"H","idx":153}]},"8":{"played":[{"name":"8","id":128,"suit":"D","idx":28},{"name":"8","id":100,"suit":"S","idx":26},{"name":"8","id":20,"suit":"D","idx":24},{"name":"8","id":7,"suit":"H","idx":97},{"name":"8","id":249,"suit":"C","idx":100},{"name":"8","id":182,"suit":"D","idx":125}]},"9":{"played":[{"name":"9","id":196,"suit":"C","idx":117},{"name":"9","id":47,"suit":"S","idx":101},{"name":"9","id":183,"suit":"D","idx":34}]},"10":{"played":[{"name":"10","id":238,"suit":"D","idx":32},{"name":"10","id":48,"suit":"S","idx":40},{"name":"2","id":14,"suit":"D","idx":93},{"name":"10","id":102,"suit":"S","idx":104},{"name":"10","id":197,"suit":"C","idx":108},{"name":"10","id":251,"suit":"C","idx":144}]},"Q":{"played":[]},"A":{"played":[{"name":"A","id":242,"suit":"C","idx":113},{"name":"A","id":93,"suit":"S","idx":80},{"name":"J","id":269,"suit":null,"idx":112}]},"W":{"played":[]},"J":{"played":[{"name":"J","id":64,"suit":"H","idx":105},{"name":"J","id":185,"suit":"D","idx":66},{"name":"2","id":94,"suit":"S","idx":72},{"name":"J","id":172,"suit":"H","idx":92},{"name":"J","id":49,"suit":"S","idx":129}]},"K":{"played":[]}},"scores":[],"index":0,"cardCt":[2,11],"playerNames":["Mark","fdsa"],"playerIds":["p-702-290","p-397-630"],"melded":true,"inFoot":["p-397-630"]},{"subId":"t-584-039","gameId":"701-346","score":0,"cards":{"4":{"played":[{"name":"4","id":57,"suit":"H","idx":19},{"name":"4","id":111,"suit":"H","idx":9},{"name":"2","id":189,"suit":"C","idx":17},{"name":"4","id":16,"suit":"D","idx":53}]},"5":{"played":[{"name":"5","id":166,"suit":"H","idx":131},{"name":"5","id":220,"suit":"H","idx":18},{"name":"5","id":192,"suit":"C","idx":10},{"name":"5","id":125,"suit":"D","idx":143},{"name":"5","id":30,"suit":"C","idx":63},{"name":"5","id":97,"suit":"S","idx":45},{"name":"2","id":256,"suit":"S","idx":21}]},"6":{"played":[{"name":"6","id":44,"suit":"S","idx":7},{"name":"6","id":221,"suit":"H","idx":3},{"name":"J","id":52,"suit":null,"idx":5},{"name":"6","id":234,"suit":"D","idx":151}]},"7":{"played":[{"name":"7","id":60,"suit":"H","idx":56},{"name":"7","id":19,"suit":"D","idx":50},{"name":"7","id":99,"suit":"S","idx":46},{"name":"7","id":194,"suit":"C","idx":103},{"name":"7","id":168,"suit":"H","idx":114},{"name":"7","id":261,"suit":"S","idx":127},{"name":"7","id":45,"suit":"S","idx":51}]},"8":{"played":[{"name":"8","id":195,"suit":"C","idx":64},{"name":"8","id":169,"suit":"H","idx":52},{"name":"J","id":160,"suit":null,"idx":58},{"name":"8","id":115,"suit":"H","idx":6},{"name":"8","id":223,"suit":"H","idx":119},{"name":"8","id":33,"suit":"C","idx":142},{"name":"2","id":122,"suit":"D","idx":95},{"name":"8","id":154,"suit":"S","idx":59}]},"9":{"played":[{"name":"9","id":75,"suit":"D","idx":130},{"name":"9","id":34,"suit":"C","idx":12},{"name":"9","id":170,"suit":"H","idx":107},{"name":"9","id":237,"suit":"D","idx":65}]},"10":{"played":[{"name":"10","id":130,"suit":"D","idx":2},{"name":"10","id":22,"suit":"D","idx":14},{"name":"J","id":53,"suit":null,"idx":8},{"name":"10","id":76,"suit":"D","idx":54},{"name":"10","id":35,"suit":"C","idx":13},{"name":"10","id":171,"suit":"H","idx":11},{"name":"2","id":135,"suit":"C","idx":139},{"name":"10","id":89,"suit":"C","idx":57},{"name":"10","id":9,"suit":"H","idx":150}]},"Q":{"played":[]},"A":{"played":[{"name":"A","id":188,"suit":"C","idx":98},{"name":"A","id":175,"suit":"D","idx":90},{"name":"2","id":202,"suit":"S","idx":0},{"name":"A","id":134,"suit":"C","idx":122},{"name":"A","id":162,"suit":"H","idx":126},{"name":"A","id":108,"suit":"H","idx":134},{"name":"A","id":0,"suit":"H","idx":15},{"name":"A","id":255,"suit":"S","idx":1},{"name":"A","id":216,"suit":"H","idx":146}]},"W":{"played":[]},"J":{"played":[{"name":"J","id":90,"suit":"C","idx":111},{"name":"J","id":198,"suit":"C","idx":62},{"name":"2","id":1,"suit":"H","idx":44},{"name":"J","id":226,"suit":"H","idx":20},{"name":"J","id":118,"suit":"H","idx":123},{"name":"J","id":239,"suit":"D","idx":61},{"name":"J","id":131,"suit":"D","idx":155}]},"K":{"played":[]}},"scores":[],"index":1,"cardCt":[1,2],"playerNames":["asdf","qwer"],"playerIds":["p-999-450","p-036-055"],"melded":true,"inFoot":["p-999-450","p-036-055"]}];
    await game.setGameData(d);
    console.log("GameData set");

    if (false) {
        setTimeout(async function() {
            console.log("executing test...");

        //     eventData = {"message":"doaction","game":"8d3-a4b","userid":"p-908-4b8","action":"draw"};
        //     var postDatas = await action.doAction(eventData);
        //     //console.log(postDatas);
        //     console.log("DONE Drawing");

        //     eventData = {"message":"doaction","game":"8d3-a4b","userid":"p-662-7cb","action":"draw"};
        //     var postDatas = await action.doAction(eventData);
        //     //console.log(postDatas);
        //     console.log("DONE Drawing");

        //     eventData = {"message":"doaction","game":"8d3-a4b","userid":"p-908-4b8","action":"discard","value":{"name":"3","id":123,"suit":"D","idx":20}};
        //     var postDatas = await action.doAction(eventData);
        //     console.log("DONE Discarding");

            // eventData = {"message":"doaction","game":"885-f15","userid":"p-46a-174","action":"draw"};
            // var postDatas = await action.doAction(eventData);
            // console.log("Done Drawing");
            // // console.log(postDatas);

            // eventData = {"message":"doaction","game":"885-f15","userid":"p-b89-ac2","action":"draw"};
            // var postDatas = await action.doAction(eventData);
            // console.log("Done Drawing");

            // eventData = {"message":"doaction","game":"885-f15","userid":"p-46a-174","action":"discard","value":{"name":"3","id":244,"suit":"C","idx":72}};
            // postDatas = await action.doAction(eventData);
            // console.log("Done Discarding");
            //console.log(postDatas);

            // eventData = {"message":"doaction","game":"885-f15","userid":"p-46a-174","action":"play","value":{"4":[],"5":[{"name":"5","id":30,"suit":"C","idx":70},{"name":"5","id":97,"suit":"S","idx":84},{"name":"5","id":166,"suit":"H","idx":86}],"6":[],"7":[],"8":[],"9":[],"10":[],"J":[],"Q":[],"K":[],"A":[{"name":"A","id":147,"suit":"S","idx":102},{"name":"A","id":216,"suit":"H","idx":66},{"name":"2","id":81,"suit":"C","idx":68}],"W":[]}};
            // postDatas = await action.doAction(eventData);
            // console.log("DONE Playig");

            eventData = {"message":"doaction","game":"701-346","userid":"p-999-450","action":"discard","value":{"name":"10","id":143,"suit":"C","idx":154}};
            var postDatas = await action.doAction(eventData);
            console.log(postDatas);
        }, 1000);
    }
}

doTest();